<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jorge Torres">

<title>Communication – MTRA</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">MTRA</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#goals-and-objectives" id="toc-goals-and-objectives" class="nav-link active" data-scroll-target="#goals-and-objectives">Goals and objectives</a>
  <ul class="collapse">
  <li><a href="#understand-the-role-of-communication-in-palliative-care" id="toc-understand-the-role-of-communication-in-palliative-care" class="nav-link" data-scroll-target="#understand-the-role-of-communication-in-palliative-care">Understand the Role of Communication in Palliative Care</a></li>
  <li><a href="#recognize-the-importance-of-a-multiprofessional-team" id="toc-recognize-the-importance-of-a-multiprofessional-team" class="nav-link" data-scroll-target="#recognize-the-importance-of-a-multiprofessional-team">Recognize the Importance of a Multiprofessional Team</a></li>
  <li><a href="#learn-effective-communication-techniques" id="toc-learn-effective-communication-techniques" class="nav-link" data-scroll-target="#learn-effective-communication-techniques">Learn Effective Communication Techniques</a></li>
  <li><a href="#real-life-case-studies" id="toc-real-life-case-studies" class="nav-link" data-scroll-target="#real-life-case-studies">Real-life Case Studies</a></li>
  <li><a href="#reocgnize-the-importance-of-feedback-and-self-reflection-in-improving-communication-skills." id="toc-reocgnize-the-importance-of-feedback-and-self-reflection-in-improving-communication-skills." class="nav-link" data-scroll-target="#reocgnize-the-importance-of-feedback-and-self-reflection-in-improving-communication-skills.">Reocgnize the importance of feedback and self-reflection in improving communication skills.</a></li>
  <li><a href="#tools-to-seek-and-provide-constructive-feedback-within-teams" id="toc-tools-to-seek-and-provide-constructive-feedback-within-teams" class="nav-link" data-scroll-target="#tools-to-seek-and-provide-constructive-feedback-within-teams">Tools to seek and provide constructive feedback within teams</a></li>
  </ul></li>
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#discussing-serious-news" id="toc-discussing-serious-news" class="nav-link" data-scroll-target="#discussing-serious-news">Discussing Serious News</a></li>
  <li><a href="#discussing-prognosis-with-patients-and-caregivers" id="toc-discussing-prognosis-with-patients-and-caregivers" class="nav-link" data-scroll-target="#discussing-prognosis-with-patients-and-caregivers">Discussing Prognosis With Patients and Caregivers</a></li>
  <li><a href="#clarifying-patient-goals-of-care" id="toc-clarifying-patient-goals-of-care" class="nav-link" data-scroll-target="#clarifying-patient-goals-of-care">Clarifying Patient Goals of Care</a></li>
  <li><a href="#leading-a-patient-and-caregiver-meeting" id="toc-leading-a-patient-and-caregiver-meeting" class="nav-link" data-scroll-target="#leading-a-patient-and-caregiver-meeting">Leading a Patient and Caregiver Meeting</a></li>
  <li><a href="#care-planning" id="toc-care-planning" class="nav-link" data-scroll-target="#care-planning">Care Planning</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Communication</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Jorge Torres </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="goals-and-objectives" class="level1">
<h1>Goals and objectives</h1>
<section id="understand-the-role-of-communication-in-palliative-care" class="level2">
<h2 class="anchored" data-anchor-id="understand-the-role-of-communication-in-palliative-care">Understand the Role of Communication in Palliative Care</h2>
<ul>
<li>Enhance patient and family outcomes</li>
<li>Know the risks associated with communication in palliative care</li>
</ul>
</section>
<section id="recognize-the-importance-of-a-multiprofessional-team" class="level2">
<h2 class="anchored" data-anchor-id="recognize-the-importance-of-a-multiprofessional-team">Recognize the Importance of a Multiprofessional Team</h2>
<ul>
<li><p>Undestand the need for a collaborative multiprofessional team in providing comprehensive palliative care.</p></li>
<li><p>Identify the roles and contributions of different healthcare professionals within the palliative care team.</p></li>
</ul>
</section>
<section id="learn-effective-communication-techniques" class="level2">
<h2 class="anchored" data-anchor-id="learn-effective-communication-techniques">Learn Effective Communication Techniques</h2>
<ul>
<li><p>Familiarization with communication skills tailored for palliative care.</p></li>
<li><p>Know tools for handling difficult conversations, such as</p></li>
<li><p>Listening / use of silence</p></li>
<li><p>Reflection</p></li>
<li><p>Summarising</p></li>
</ul>
</section>
<section id="real-life-case-studies" class="level2">
<h2 class="anchored" data-anchor-id="real-life-case-studies">Real-life Case Studies</h2>
</section>
<section id="reocgnize-the-importance-of-feedback-and-self-reflection-in-improving-communication-skills." class="level2">
<h2 class="anchored" data-anchor-id="reocgnize-the-importance-of-feedback-and-self-reflection-in-improving-communication-skills.">Reocgnize the importance of feedback and self-reflection in improving communication skills.</h2>
</section>
<section id="tools-to-seek-and-provide-constructive-feedback-within-teams" class="level2">
<h2 class="anchored" data-anchor-id="tools-to-seek-and-provide-constructive-feedback-within-teams">Tools to seek and provide constructive feedback within teams</h2>
</section>
</section>
<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Effective communication in palliative care is crucial, particularly when discussing end-of-life care.</p>
<p>Research highlights that attitudes towards these sensitive conversations among both the public and healthcare professionals are positive and both view this topic as important.</p>
<p>A systematic review by Sharp et al. <span class="citation" data-cites="SharpEtAl2013">[@SharpEtAl2013]</span> showed that the majority of older individuals (61%-91%) expressed a desire to discuss their end-of-life care, with many feeling comfortable or even enthusiastic about these conversations. Healthcare professionals generally also recognized the importance of these discussions, and most doctors (91%-97%) believed they are essential when dealing with severe chronic or terminal illnesses.</p>
<p>Despite these positive attitudes, actual end-of-life care discussions remain scarce.</p>
<p>Gamble et al. <span class="citation" data-cites="GambleEtAl1991">[@GambleEtAl1991]</span> for example showed that while 81% of patients wanted to talk about end-of-life care with their physicians, only 11% had done so, and that these conversations were usually initiated by the patients themselves. Similarly, a 2021 Canadian poll revealed that although 59% of Canadians had discussed their care wishes with family, only 7% had communicated these preferences to a healthcare provider. <span class="citation" data-cites="TheAdvanceCarePlanninginCanadainitiative2021">[@TheAdvanceCarePlanninginCanadainitiative2021]</span></p>
<p>These findings underscore the need for more proactive and widespread communication about end-of-life care in palliative settings to ensure that patient preferences are understood and respected.</p>
<p>The significance of early integration into palliative care is well-established, with a considerable portion of the benefits attributed to effective communication. For example, Yoong et al. <span class="citation" data-cites="YoongEtAl2013">[@YoongEtAl2013]</span> found that addressing symptoms and coping were the most prevalent components of palliative care clinic visits, which focused on building relationships and rapport with patients and their families and on understanding the illness, including prognostic awareness.</p>
<p>However, healthcare professionals should not use communication tools derived from speciliist palliative care indiscriminately.</p>
<p>This was demonstrated in a randomized study conducted by Curtis et al.<span class="citation" data-cites="CurtisEtAl2013">[@CurtisEtAl2013]</span> they conducted a workshop consisting of eight 4-hour sessions led by a physician and a nurse. This workshop was designed to improve communication skills for oncology fellows and was associated with the acquisition of new skills in both:</p>
<ul>
<li>delivering bad news</li>
<li>responding to emotions</li>
</ul>
<p>However, there was no significant change in ratings of quality of care or quality of end-of-life care as assessed by patients, family, or other clinicians.</p>
<p>This finding suggests that improvements in communication skills observed in a controlled, standardized setting may not necessarily translate to enhancements in real-world clinical practice.</p>
<p>Conversely, they did demonstrate a significant improvement in quality of care among patients who rated their health status as “poor”. Moreover, an increase in patients’ depressive symptoms associated with the intervention was observed, indicating that awareness of prognosis may trigger negative experiences if not properly addressed by an expert.</p>
<p>This results underscore the importance of carefully selecting appropriate patients before communicating whit them using specialist palliative care techniques.</p>
<p>Studies that investigate the negative side effects of comunication in specialist palliative care are lacking, however because of certain similarities a comparison with bereavement counselling might be helpful:</p>
<p>Negative side effects of bereavement counselling are known to exist and are also currently being researched. This is logical since bereavement counselling is a psychosocial intervention, sharing characteristics with psychotherapy, such as the need to establish a therapeutic alliance that requires trust and openness from patients.</p>
<p>Because bereavement counselling is a psychosocial intervention similar to psychotherapy, negative side effects are known to exist and are currently under study.</p>
<p>This negative effects can either be<span class="citation" data-cites="TelaarEtAl2023">[@TelaarEtAl2023]</span>: - unintended detrimental consequences of properly applied interventions (i.e.&nbsp;side effects) - The result from inappropriately applied interventions, such as unethical behavior and malpractice.</p>
<p>Examples of these negative effects can be found in a study by Moritz et al. <span class="citation" data-cites="MoritzEtAl2019">[@MoritzEtAl2019]</span> involving individuals with depression. While positive effects were reported by virtually all patients (95.6%), approximately half of them (52.6%) also reported experiencing at least one adverse event.</p>
<p>These considerations highlight the necessity for a careful approach to using specialist palliative care communication tools. It is crucial to ensure that these tools are targeted toward those who will benefit the most while avoiding potential adverse effects for others.</p>
<p>This was demonstrated in a study conducted by Currier et al.<span class="citation" data-cites="CurrierEtAl2008">[@CurrierEtAl2008]</span>, where interventions for bereaved persons were differentiated as follows:</p>
<ul>
<li>Universal</li>
<li>Selective</li>
<li>Indicated</li>
</ul>
<p>Universal interventions targeted anyone who suffered bereavement, regardless of pre-intervention functioning.</p>
<p>Selective interventions were aimed at particular groups of bereaved individuals who faced a heightened risk of experiencing distress symptoms, such as those who lost a child to a violent death.</p>
<p>Lastly, indicated interventions were restricted to those manifesting clinically significant difficulties adapting to loss.</p>
<p>In this study, interventions targeting universal populations and higher-risk grievers failed to produce good outcomes. Conversely, the effect sizes of the indicated interventions compared favorably with the successes shown for psychotherapy in general.</p>
<p>Further more it is important to underscore that losing a loved one to death (or dying) is an inherent part of human life and that only about 7% of bereaved older adults will develop the mental health condition known as complicated grief. <span class="citation" data-cites="ShearEtAl2013">[@ShearEtAl2013]</span></p>
<p>In summary, while effective communication in palliative care is essential, it’s indiscriminate application could lead to negative side effects, e.g.&nbsp;depression. Additionally, physicians often do not need to employ specialist palliative care communication skills and tools with patients at the end of life to provide adequate care.</p>
<p>Therefore, when communicating in end-of-life situations physicians should prioritize being approachable, honest, warm, and authentic over using technical skills and communication tools. However, clinicians who lack proficiency in palliative care communication skills will inevitably encounter situations where technical expertise is essential for appropriately discussing prognosis and the process of dying. Hence, this section will focus on introducing essential communication tools to enhance the effectiveness and ease of such critical interactions.</p>
<p>The Cardiff six-point toolkit<span class="citation" data-cites="KissaneEtAl2017">[@KissaneEtAl2017]</span>: ## Comfort ## Language ## Question style ## Listening / use of silence ## Reflection ## Summarising</p>
</section>
<section id="discussing-serious-news" class="level1">
<h1>Discussing Serious News</h1>
<p>Learn best practices for having patient-centered conversations about a serious illness diagnosis.</p>
</section>
<section id="discussing-prognosis-with-patients-and-caregivers" class="level1">
<h1>Discussing Prognosis With Patients and Caregivers</h1>
<p>Learn how to effectively discuss prognosis with patients and their caregivers.</p>
</section>
<section id="clarifying-patient-goals-of-care" class="level1">
<h1>Clarifying Patient Goals of Care</h1>
<p>Learn best practices for building trust, eliciting patient values, and having patient-centered conversations about goals of care.</p>
</section>
<section id="leading-a-patient-and-caregiver-meeting" class="level1">
<h1>Leading a Patient and Caregiver Meeting</h1>
<p>Learn to effectively lead meetings that help patients and caregivers become aligned around the patient’s goals.</p>
</section>
<section id="care-planning" class="level1">
<h1>Care Planning</h1>
<p>Learn techniques to help patients and their caregivers plan for the future, both during the early stages of a serious illness and as a disease progresses.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/MD-Torres\.github\.io\/mtra-schule\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>